# --- !Ups

CREATE TABLE Messages (
  message VARCHAR NOT NULL,
  toUserId BIGINT NOT NULL, 
  fromUserId BIGINT NOT NULL, 
  id BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY);

CREATE TABLE Transactions (
  storageTaken INT NOT NULL,
  fromDate TIMESTAMP NOT NULL,
  toDate TIMESTAMP NOT NULL,
  timestamp TIMESTAMP NOT NULL,
  postingId BIGINT NOT NULL,
  buyerUserId BIGINT NOT NULL, 
  fromUserId BIGINT NOT NULL, 
  id BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY);

CREATE TABLE User (
  userID BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  name VARCHAR NOT NULL,
  surname VARCHAR NOT NULL,
  email VARCHAR NOT NULL UNIQUE,
  password VARCHAR NOT NULL,
  verifiedEmail SMALLINT DEFAULT 0,
  thumbnail VARCHAR,
  universityID BIGINT NOT NULL,
  creationTime BIGINT NOT NULL,
  lastLogin BIGINT);

CREATE VIEW VerifiedUser AS
  SELECT * 
  FROM User
  WHERE verifiedEmail = 1;

CREATE TABLE Location (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY,
  name VARCHAR NOT NULL,
  lat DECIMAL(9,6) NOT NULL,
  lng DECIMAL(9,6) NOT NULL,
  city VARCHAR(70) NOT NULL,
  state VARCHAR(70) NOT NULL,
  address VARCHAR NOT NULL,
  zip VARCHAR(32) NOT NULL);
  
CREATE TABLE University (
  locationID BIGINT NOT NULL,
  name VARCHAR NOT NULL,
  website VARCHAR(2083) NOT NULL,
  logo VARCHAR NOT NULL,
  colors VARCHAR NOT NULL,
  --CONSTRAINT pk_University PRIMARY_KEY (name,locationID)
  FOREIGN KEY(locationID) REFERENCES Location(id) ON DELETE CASCADE,
  PRIMARY KEY (name, locationID));

--CREATE TABLE University (
  --name VARCHAR NOT NULL,
  --website VARCHAR(2083) NOT NULL, 
  --logo VARCHAR NOT NULL,
  --colors VARCHAR NOT NULL,
  --PRIMARY_KEY(name,locationID),
  --FOREIGN KEY(locationID) REFERENCES Location(locationID) ON DELETE CASCADE);

# --- !Downs

DROP VIEW VerifiedUser;
DROP TABLE Messages;
DROP TABLE Transactions;
DROP TABLE User;
DROP TABLE University;
DROP TABLE Location;
